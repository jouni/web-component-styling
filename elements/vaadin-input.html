<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/src/styling/custom-style.html">

<dom-module id="vaadin-input">
  <template>
    <style>
      :host {
        display: inline-flex;
        flex-direction: column;
        @apply --vaadin-input;
      }

      label {
        @apply --vaadin-input__label;
      }

      input {
        background: transparent;
        color: inherit;
        font: inherit;
        border: 0;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        width: 100%;
        @apply --vaadin-input__input;
      }

      input::-webkit-input-placeholder {
        color: inherit;
        opacity: 0.4;
        @apply --vaadin-input__placeholder;
      }

      :host::after {
        @apply --vaadin-input__pseudo--after;
      }

      /* Focus selectors */

      :host([focus]) {
        @apply --vaadin-input--focus;
      }

      :host([focus]) label {
        @apply --vaadin-input--focus__label;
      }

      :host([focus]) input {
        @apply --vaadin-input--focus__input;
      }

      :host([focus])::after {
        @apply --vaadin-input--focus__pseudo--after;
      }

      /* Empty value selectors */

      :host([empty]:not([placeholder])) {
        @apply --vaadin-input--empty;
      }

      :host([empty]:not([placeholder])) input {
        @apply --vaadin-input--empty__input;
      }

      :host([empty]:not([placeholder])) label {
        @apply --vaadin-input--empty__label;
      }

      :host([empty]:not([placeholder]))::after {
        @apply --vaadin-input--empty__pseudo--after;
      }
    </style>
    <label></label>
    <input>
  </template>
  <script>
    class VaadinInput extends Polymer.Element {
      static get is() {
        return "vaadin-input";
      }

      ready() {
        super.ready();

        var input = this.root.querySelector("input");
        var label = this.root.querySelector("label");

        input.id = this._computeId();
        label.setAttribute("for", input.id);

        if (this.hasAttribute("label")) {
          label.innerText = this.getAttribute("label");
        }

        if (this.hasAttribute("placeholder")) {
          input.placeholder = this.getAttribute("placeholder");
        } else if(!this.hasAttribute("value")) {
          this.setAttribute("empty", "");
        }

        input.addEventListener("input", (e) => this._input(e));
        input.addEventListener("focus", (e) => this._focus(e));
        input.addEventListener("blur", (e) => this._blur(e));
      }

      _computeId() {
        return "vaadin-input-" + Math.round(Math.random() * 100);
      }

      _input(e) {
        if(e.target.value === "") {
          this.setAttribute("empty", "")
        } else {
          this.removeAttribute("empty");
        }
      }

      _focus(e) {
        this.setAttribute("focus", "");
      }

      _blur(e) {
        this.removeAttribute("focus");
      }
    }

    customElements.define(VaadinInput.is, VaadinInput);

  </script>
</dom-module>
