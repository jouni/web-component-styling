<link rel="import" href="../bower_components/polymer/polymer-element.html">
<!-- <link rel="import" href="../bower_components/polymer/src/styling/custom-style.html"> -->

<dom-module id="vaadin-input">
  <template>
    <style>
      :host {
        display: inline-flex;
        flex-direction: column;
      }

      label {
        @apply --vaadin-input__label;
      }

      input {
        @apply --vaadin-input__input;
      }

      input::-webkit-input-placeholder {
        @apply --vaadin-input__input-placeholder;
      }

      input::-ms-input-placeholder {
        @apply --vaadin-input__input-placeholder;
      }

      input::placeholder {
        @apply --vaadin-input__input-placeholder;
      }
    </style>
    <label></label>
    <input>
  </template>
  <script>
    class VaadinInput extends Polymer.Element {
      static get is() {
        return "vaadin-input";
      }

      ready() {
        super.ready();

        const input = this.root.querySelector("input");
        const label = this.root.querySelector("label");

        input.id = this._computeId();
        label.setAttribute("for", input.id);

        if (this.hasAttribute("label")) {
          label.innerText = this.getAttribute("label");
        }

        if (this.hasAttribute("placeholder")) {
          input.placeholder = this.getAttribute("placeholder");
        }

        if (!this.hasAttribute("value") && !this.hasAttribute("placeholder")) {
          this.setAttribute("empty", "");
        }

        if(this.hasAttribute("value")) {
          input.value = this.getAttribute("value");
        }

        input.addEventListener("input", (e) => this._input(e));
        input.addEventListener("focus", (e) => this._focus(e));
        input.addEventListener("blur", (e) => this._blur(e));
      }

      _computeId() {
        return "vaadin-input-" + Math.round(Math.random() * 100);
      }

      _input(e) {
        if(e.target.value === "" && e.target.placeholder == "") {
          this.setAttribute("empty", "")
        } else {
          this.removeAttribute("empty");
        }
        this.updateStyles();
      }

      _focus(e) {
        this.setAttribute("focus", "");
        this.updateStyles();
      }

      _blur(e) {
        this.removeAttribute("focus");
        this.updateStyles();
      }
    }

    customElements.define(VaadinInput.is, VaadinInput);

  </script>
</dom-module>
