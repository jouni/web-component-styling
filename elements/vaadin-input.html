<dom-module id="vaadin-input">
  <template>
    <style>
      :host {
        display: inline-flex;
        flex-direction: column;
        @apply(--vaadin-input);
      }

      :host(.vaadin-input--focus) {
        @apply(--vaadin-input--focus);
      }

      input {
        background: transparent;
        color: inherit;
        font: inherit;
        border: 0;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        @apply(--vaadin-input__input);
      }

      input::-webkit-input-placeholder {
        color: inherit;
        opacity: 0.4;
        @apply(--vaadin-input__input--placeholder);
      }

      input:focus {
        @apply(--vaadin-input__input--focus);
      }

      label {
        @apply(--vaadin-input__label);
      }

      input:focus ~ label {
        @apply(--vaadin-input__label--focus);
      }

      .error {
        margin: 0;
        @apply(--vaadin-input__error);
      }

      input:focus ~ .error {
        @apply(--vaadin-input__error--focus);
      }

      input:valid ~ label {
        @apply(--vaadin-input__label--input-has-value);
      }
    </style>
    <template is="dom-if" if="[[label]]" restamp="true">
      <label for$="[[_id]]">[[label]]</label>
    </template>
    <input value="[[value]]" id$="[[_id]]" placeholder="[[placeholder]]" required on-input="_input" on-focus="_focus" on-blur="_blur">
    <template is="dom-if" if="[[error]]" restamp="true">
      <p class="error">[[error]]</p>
    </template>
  </template>
  <script>
    Polymer({
      is: 'vaadin-input',

      properties: {
        _id: {
          type: String,
          computed: "_computeId(label)"
        },
        label: {
          type: String,
          reflectToAttribute: true
        },
        placeholder: {
          type: String,
          reflectToAttribute: true
        },
        value: {
          type: String,
          reflectToAttribute: true
        },
        error: {
          type: String,
          reflectToAttribute: true
        }
      },

      _computeId: function(label) {
        return "vaadin-input-" + Math.round(Math.random() * 100);
      },

      _input: function(e) {
        this.toggleClass("vaadin-input--has-value", e.target.value !== "");
      },

      _focus: function(e) {
        this.toggleClass("vaadin-input--focus", true);
      },

      _blur: function(e) {
        this.toggleClass("vaadin-input--focus", false);
      }
    });

  </script>
</dom-module>
