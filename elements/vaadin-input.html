<link rel="import" href="../bower_components/polymer/polymer-element.html">
<!-- <link rel="import" href="../bower_components/polymer/src/styling/custom-style.html"> -->

<dom-module id="vaadin-input">
  <template>
    <style>
      :host {
        display: inline-flex;
        flex-direction: column;
        @apply --vaadin-input;
      }

      label {
        @apply --vaadin-input__label;
      }

      input {
        @apply --vaadin-input__input;
      }

      input::-webkit-input-placeholder {
        @apply --vaadin-input__input-placeholder;
      }

      /*
      In order to workaround the ShadyCSS polyfill limitations,
      it is necessary to have explicit mixins for each different state.

      For exapmle, if you declare `border-top` in the default state, and want to
      override all borders in the focused state, you need to explicitly override
      `border-top` also in the mixin declaration you target for the focused state,
      if you use regular CSS selectors to declare the mixin value.

      Just overriding border is not enough, as the that will cause the
      `border-top` declaration to not have a value in the focused state, but the
      element will still be setting the border-top value as a custom property.

      See "../themes/valo/valo-input.html" for an example.
      */

      /* Focused state */

      :host([focus]) {
        @apply --vaadin-input--focus;
      }

      :host([focus]) label {
        @apply --vaadin-input--focus__label;
      }

      :host([focus]) input {
        @apply --vaadin-input--focus__input;
      }

      :host([focus]) input::-webkit-input-placeholder {
        @apply --vaadin-input--focus__input-placeholder;
      }

      /* Empty state */

      :host([empty]) {
        @apply --vaadin-input--empty;
      }

      :host([empty]) label {
        @apply --vaadin-input--empty__label;
      }

      :host([empty]) input {
        @apply --vaadin-input--empty__input;
      }

      :host([empty]) input::-webkit-input-placeholder {
        @apply --vaadin-input--empty__input-placeholder;
      }
    </style>
    <label></label>
    <input>
  </template>
  <script>
    class VaadinInput extends Polymer.Element {
      static get is() {
        return "vaadin-input";
      }

      ready() {
        super.ready();

        const input = this.root.querySelector("input");
        const label = this.root.querySelector("label");

        input.id = this._computeId();
        label.setAttribute("for", input.id);

        if (this.hasAttribute("label")) {
          label.innerText = this.getAttribute("label");
        }

        if (this.hasAttribute("placeholder")) {
          input.placeholder = this.getAttribute("placeholder");
        }

        if (!this.hasAttribute("value") && !this.hasAttribute("placeholder")) {
          this.setAttribute("empty", "");
        }

        if(this.hasAttribute("value")) {
          input.value = this.getAttribute("value");
        }

        input.addEventListener("input", (e) => this._input(e));
        input.addEventListener("focus", (e) => this._focus(e));
        input.addEventListener("blur", (e) => this._blur(e));
      }

      _computeId() {
        return "vaadin-input-" + Math.round(Math.random() * 100);
      }

      _input(e) {
        if(e.target.value === "" && e.target.placeholder == "") {
          this.setAttribute("empty", "")
        } else {
          this.removeAttribute("empty");
        }
      }

      _focus(e) {
        this.setAttribute("focus", "");
      }

      _blur(e) {
        this.removeAttribute("focus");
      }
    }

    customElements.define(VaadinInput.is, VaadinInput);

  </script>
</dom-module>
