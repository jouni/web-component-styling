<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="size-slider">
  <template>
    <style>
      :host {
        display: inline-flex;
        /*flex-direction: column;*/
        align-items: center;
      }
      label {
        font-size: 13px;
        font-family: -apple-system, BlinkMacSystemFont;
        font-weight: 500;
        min-width: 130px;
        width: 100%;
        display: flex;
        justify-content: space-between;
        text-transform: capitalize;
      }

      label span {
        /*display: none;*/
        white-space: nowrap;
      }

      .value {
        opacity: 0.3;
      }

      input {
        width: 100%;
        margin-left: 1em;
      }
    </style>
    <label></label>
    <input type="range" value="[[value]]" on-input="_input">
  </template>

  <script>
    class SizeSlider extends Polymer.Element {
      static get is() {
        return "size-slider";
      }

      static get properties() {
        return {
          property: {
            type: String,
            observer: "_propertyChanged"
          },
          value: {
            type: String,
            observer: "_valueChanged"
          }
        };
      }

      constructor() {
        super();
      }

      _propertyChanged(property, oldProperty) {
        if (oldProperty === undefined) {
          // Read initial value from computed style
          setTimeout(function() {
            var initialValue = parseInt(getComputedStyle(document.documentElement).getPropertyValue(property));
            this.value = initialValue;
            // this.root.querySelector("input").min = Math.floor(this.value / 2);
            if (this.hasAttribute("max")) {
              this.root.querySelector("input").max = this.getAttribute("max");
            } else {
              this.root.querySelector("input").max = Math.ceil(this.value * 2);
            }
          }.bind(this), 200);
        }
      }

      _valueChanged(value, oldValue) {
        if(value !== oldValue) {
          document.documentElement.style.setProperty(this.property, value + "px");
          this.root.querySelector("label").innerHTML = "<span class=name>" + this.property.substring(2).replace("-", " ") + "</span> <span class=value>" + this.value + "px</span>";
          var props = {};
          props[this.property] = value + "px";
          // ShadyCSS.updateStyles(props);
        }
      }

      _input(e) {
        this.value = (e.target || e.path[0]).value;
      }

      _change(e) {
      }

    }

    customElements.define(SizeSlider.is, SizeSlider);

  </script>
</dom-module>
